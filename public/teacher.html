<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher - Smart Schedule</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<style>
/* BODY & BACKGROUND */
body {
  font-family: Arial, sans-serif;
  min-height: 100vh;
  margin: 0;
  padding: 0;
  background: linear-gradient(135deg, #6a5ce7, #00b894); /* Same as home page */
  background-attachment: fixed;
  color: #fff;
}

/* SIDEBAR BACK BUTTON */
.sidebar {
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.35);
  padding: 12px 8px;
  border-top-right-radius: 10px;
  border-bottom-right-radius: 10px;
  transition: all 0.3s;
  cursor: pointer;
  box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
  z-index: 100;
}

.sidebar:hover {
  background: rgba(0, 0, 0, 0.55);
}

.sidebar span {
  writing-mode: vertical-rl;
  transform: rotate(180deg);
  font-weight: bold;
  color: #fff;
  letter-spacing: 1px;
}

/* NAVBAR */
.navbar {
  background: rgba(255, 255, 255, 0.15); /* Semi-transparent */
  border-radius: 8px;
  color: #fff;
}

/* NAV BUTTONS */
.navBtn {
  color: #fff;
  border: none;
  transition: all 0.3s;
}

.navBtn.active, .navBtn:hover {
  background: rgba(255, 255, 255, 0.5);
  color: #fff;
}

/* SECTIONS */
.section {
  background: rgba(255, 255, 255, 0.9);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  color: #000;
}

/* TABLE & INPUTS */
table {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 12px;
}

input.form-control, select.form-select {
  border-radius: 8px;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}

/* BUTTONS */
button {
  background: #6a5ce7; /* Home page purple */
  color: #fff;
  border: none;
  border-radius: 8px;
  transition: all 0.3s;
}

button:hover {
  background: #00b894; /* Green accent from gradient */
  color: #fff;
}

/* NOTIFICATION INPUTS */
#notifSection input {
  border-radius: 8px;
}

/* CUSTOM CURSOR FOR SLOT */
.custom-slot {
  cursor: pointer;
}
</style>
</head>

<body class="container p-4">

<!-- Sidebar Back Button -->
<div class="sidebar" onclick="history.back()">
  <span>BACK</span>
</div>

<!-- TEACHER NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark mb-4">
  <div class="container-fluid">
    <span class="navbar-brand">üë©‚Äçüè´ Teacher Panel</span>
    <div class="d-flex gap-2">
      <button class="btn btn-outline-light navBtn active" data-target="updateSection">Update Timetable</button>
      <button class="btn btn-outline-light navBtn" data-target="deleteSection">Delete Timetable</button>
      <button class="btn btn-outline-light navBtn" data-target="notifSection">Send Notification</button>
    </div>
  </div>
</nav>

<!-- UPDATE SECTION -->
<div id="updateSection" class="section">

<h2>Teacher Panel</h2>

<table class="table table-bordered text-center">
<thead>
<tr>
  <th>Day</th>
  <th>Time</th>
  <th>Subject</th>
  <th>Action</th>
</tr>
</thead>
<tbody id="tableBody">
<tr>
  <td>
    <select class="form-select day">
      <option>Monday</option>
      <option>Tuesday</option>
      <option>Wednesday</option>
      <option>Thursday</option>
      <option>Friday</option>
      <option>Saturday</option>
    </select>
  </td>

  <td>
    <select class="form-select time">
      <option value="">Select Time</option>
      <option>09:00-10:00</option>
      <option>10:00-11:00</option>
      <option>11:00-12:00</option>
      <option>12:00-01:00</option>
      <option>01:00-02:00</option>
      <option>02:00-03:00</option>
      <option>03:00-04:00</option>
    </select>
    <input class="form-control mt-1 customTime" placeholder="Custom time (optional)">
  </td>

  <td>
    <input list="subjects" class="form-control lecture" placeholder="Subject">
    <datalist id="subjects">
      <option>CG</option>
      <option>PA</option>
      <option>DBMS</option>
      <option>OS</option>
      <option>CN</option>
      <option>AI</option>
    </datalist>
  </td>

  <td>
    <button class="btn btn-primary updateBtn">Update</button>
  </td>
</tr>
</tbody>
</table>

<button id="addRow" class="btn btn-success mb-4">Add Row</button>

</div>

<!-- DELETE SECTION -->
<div id="deleteSection" class="section" style="display:none;">
<h4>Delete Timetable Slot</h4>

<table class="table table-bordered text-center">
<thead>
<tr>
  <th>Day</th>
  <th>Time</th>
  <th>Subject</th>
  <th>Action</th>
</tr>
</thead>
<tbody>
<tr>
  <td>
    <select class="form-select dDay">
      <option>Monday</option>
      <option>Tuesday</option>
      <option>Wednesday</option>
      <option>Thursday</option>
      <option>Friday</option>
      <option>Saturday</option>
    </select>
  </td>

  <td>
    <input class="form-control dTime" placeholder="09:00-10:00">
  </td>

  <td>
    <input class="form-control dLecture" placeholder="Subject">
  </td>

  <td>
    <button class="btn btn-danger deleteBtn">Delete</button>
  </td>
</tr>
</tbody>
</table>
</div>

<!-- NOTIFICATION SECTION -->
<div id="notifSection" class="section" style="display:none;">
<hr>
<h4>Send Notification</h4>
<div class="row g-2">
  <div class="col-4">
    <input id="notifTitle" class="form-control" placeholder="Title">
  </div>
  <div class="col-6">
    <input id="notifMessage" class="form-control" placeholder="Message">
  </div>
  <div class="col-2">
    <button id="sendNotifBtn" class="btn btn-warning w-100">Send</button>
  </div>
</div>
</div>

<script>
const socket = io();
const tableBody = document.getElementById("tableBody");

/* NAV TOGGLE */
document.querySelectorAll(".navBtn").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".navBtn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll(".section").forEach(s=>s.style.display="none");
    document.getElementById(btn.dataset.target).style.display="block";
  };
});

/* ADD ROW */
document.getElementById("addRow").onclick = () => {
  const row = tableBody.children[0].cloneNode(true);
  row.querySelectorAll("input,select").forEach(i=>i.value="");
  tableBody.appendChild(row);
};

/* UPDATE ROW */
tableBody.addEventListener("click", async e => {
  if(!e.target.classList.contains("updateBtn")) return;

  const row = e.target.closest("tr");
  const day = row.querySelector(".day").value;
  const dropdownTime = row.querySelector(".time").value;
  const customTime = row.querySelector(".customTime").value.trim();
  const time = customTime || dropdownTime;
  const lecture = row.querySelector(".lecture").value.trim();

  if(!day || !time || !lecture){
    alert("Fill all fields");
    return;
  }

  const res = await fetch("/update",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ day, time, lecture })
  });

  const data = await res.json();

  if(data.success){
    alert("‚úÖ Updated");
  } else if(data.slotFull){
    alert("‚ùå Slot full\nFree slots:\n" + data.freeSlots.join("\n"));
  }
});

/* DELETE LECTURE */
document.querySelector(".deleteBtn").onclick = async ()=>{
  const day = document.querySelector(".dDay").value;
  const time = document.querySelector(".dTime").value.trim();
  const lecture = document.querySelector(".dLecture").value.trim();

  if(!day || !time || !lecture){
    alert("Fill all fields");
    return;
  }

  await fetch("/delete",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ day, time, lecture })
  });

  alert("üóë Lecture Deleted");
};

/* NOTIFICATION */
document.getElementById("sendNotifBtn").onclick = async ()=>{
  const notifTitle = document.getElementById("notifTitle");
  const notifMessage = document.getElementById("notifMessage");

  if(!notifTitle.value || !notifMessage.value){
    alert("Fill both fields");
    return;
  }

  await fetch("/send-notification",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      type: notifTitle.value,
      message: notifMessage.value
    })
  });

  notifTitle.value="";
  notifMessage.value="";
  alert("üîî Notification Sent");
};
</script>

</body>
</html>
